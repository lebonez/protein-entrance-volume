<!DOCTYPE html>

<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, user-scalable=no, minimum-scale=1.0, maximum-scale=1.0">
</head>

<body>
    <div id="container">
    </div>

    <script src="lib/three.min.js"></script>
    <script src="lib/Detector.js"></script>
    <script src="lib/OrbitControls.js"></script>
    <script src="lib/stats.min.js"></script>
    <script src="lib/jquery.min.js"></script>
    <script src="lib/PLYLoader.js"></script>

    <script>
        if (!Detector.webgl) Detector.addGetWebGLMessage();

        var container, stats;
        var camera, scene, renderer;
        var points;

        init();
        animate();

        function init() {

            var camera_x = CAMERA_X_PLACEHOLDER;
            var camera_y = CAMERA_Y_PLACEHOLDER;
            var camera_z = CAMERA_Z_PLACEHOLDER;

            var look_x = LOOK_X_PLACEHOLDER;
            var look_y = LOOK_Y_PLACEHOLDER;
            var look_z = LOOK_Z_PLACEHOLDER;

            var PX = new Float32Array(POCKETS_X_PLACEHOLDER);
            var PZ = new Float32Array(POCKETS_Z_PLACEHOLDER);
            var PY = new Float32Array(POCKETS_Y_PLACEHOLDER);
            var PS = POCKETS_S_PLACEHOLDER;
            // var PP = PLANE_POINTS_PLACEHOLDER;
            // var PPS = PLANE_POINTS_PLACEHOLDER;

            var PR = new Float32Array(POCKETS_R_PLACEHOLDER);
            var PG = new Float32Array(POCKETS_G_PLACEHOLDER);
            var PB = new Float32Array(POCKETS_B_PLACEHOLDER);

            var AX = new Float32Array(ATOMS_X_PLACEHOLDER);
            var AY = new Float32Array(ATOMS_Y_PLACEHOLDER);
            var AZ = new Float32Array(ATOMS_Z_PLACEHOLDER);
            var Ar = new Float32Array(ATOMS_r_PLACEHOLDER);

            var AR = new Float32Array(ATOMS_R_PLACEHOLDER);
            var AG = new Float32Array(ATOMS_G_PLACEHOLDER);
            var AB = new Float32Array(ATOMS_B_PLACEHOLDER);

            var HULL_VECTORS = HULL_VECTORS_PLACEHOLDER;

            var n_hull = N_HULL_PLACEHOLDER;
            var n_pockets = N_POCKETS_PLACEHOLDER;
            var n_voxels = N_VOXELS_PLACEHOLDER;

            var axis_size = AXIS_SIZE_PLACEHOLDER;

            container = document.getElementById('container');

            scene = new THREE.Scene();

            camera = new THREE.PerspectiveCamera(90, window.innerWidth / window.innerHeight, 0.1, 1000);
            camera.position.x = camera_x;
            camera.position.y = camera_y;
            camera.position.z = camera_z;
            camera.up = new THREE.Vector3(0, 0, 1);

            if (axis_size > 0) {
                var axisHelper = new THREE.AxisHelper(axis_size);
                scene.add(axisHelper);
            }

            var geometry = new THREE.BoxGeometry(PS, PS, PS);

            for (var i = 0; i < n_pockets; i++) {
                var mesh = new THREE.Mesh(geometry, new THREE.MeshBasicMaterial());
                mesh.material.color.setRGB(PR[i], PG[i], PB[i]);
                mesh.material.transparent = true;
                mesh.material.opacity = 0.3;
                mesh.position.x = PX[i];
                mesh.position.y = PY[i];
                mesh.position.z = PZ[i];
                scene.add(mesh);
            }

            for (var i = 0; i < n_voxels; i++) {
                var geometry = new THREE.SphereGeometry(Ar[i], 12, 10);
                var mesh = new THREE.Mesh(geometry, new THREE.MeshBasicMaterial());
                mesh.material.color.setRGB(AR[i], AG[i], AB[i]);
                mesh.position.x = AX[i];
                mesh.position.y = AY[i];
                mesh.position.z = AZ[i];
                scene.add(mesh);
            }

            // var geometry = new THREE.Geometry();
            // var v1 = new THREE.Vector3(PP[0][0], PP[0][1], PP[0][2]);
            // var v2 = new THREE.Vector3(PP[1][0], PP[1][1], PP[1][2]);
            // var v3 = new THREE.Vector3(PP[2][0], PP[2][1], PP[2][2]);
            // geometry.vertices.push(v1, v2, v3);
            // geometry.faces.push( new THREE.Face3( 0, 1, 2 ) );
            // var lines = new THREE.Line( geometry, new THREE.MeshBasicMaterial() );
            // lines.material.color.setRGB(0.8, 0, 0)
            // scene.add(lines);

            for (var i = 0; i < n_hull; i++) {
                var geometry = new THREE.Geometry();
                geometry.vertices.push(
                	new THREE.Vector3( HULL_VECTORS[i][0][0], HULL_VECTORS[i][0][1], HULL_VECTORS[i][0][2] ),
                	new THREE.Vector3( HULL_VECTORS[i][1][0], HULL_VECTORS[i][1][1], HULL_VECTORS[i][1][2] ),
                	new THREE.Vector3( HULL_VECTORS[i][2][0], HULL_VECTORS[i][2][1], HULL_VECTORS[i][2][2] )
                );
                geometry.faces.push( new THREE.Face3( 0, 1, 2 ) );
                var lines = new THREE.Line( geometry, new THREE.MeshBasicMaterial() );
                lines.material.color.setRGB(0, 0, 0.8)
                scene.add(lines);
            }

            renderer = new THREE.WebGLRenderer({ antialias: false });
            renderer.setPixelRatio(window.devicePixelRatio);
            renderer.setSize(window.innerWidth, window.innerHeight);

            controls = new THREE.OrbitControls(camera, renderer.domElement);
            controls.target.copy(new THREE.Vector3(look_x, look_y, look_z));
            camera.lookAt(new THREE.Vector3(look_x, look_y, look_z));

            container.appendChild(renderer.domElement);

            window.addEventListener('resize', onWindowResize, false);
        }

        function onWindowResize() {
            camera.aspect = window.innerWidth / window.innerHeight;
            camera.updateProjectionMatrix();
            renderer.setSize(window.innerWidth, window.innerHeight);
        }

        function animate() {
            requestAnimationFrame(animate);
            render();
        }

        function render() {
            renderer.render(scene, camera);
        }

    </script>
</body>

</html>
